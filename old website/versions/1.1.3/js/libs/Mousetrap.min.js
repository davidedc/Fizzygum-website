var Mousetrap,_KEYCODE_MAP,_MAP,_REVERSE_MAP,_SHIFT_MAP,_SPECIAL_ALIASES,_addEvent,_bindMultiple,_bindSequence,_bindSingle,_callbacks,_characterFromEvent,_directMap,_eventModifiers,_fireCallback,_getMatches,_getReverseMap,_handleCharacter,_handleKey,_ignoreNextKeyup,_isModifier,_modifiersMatch,_pickBestAction,_resetSequenceTimer,_resetSequences,_resetTimer,_sequenceLevels,_sequenceType,i;for(_MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta",return:"enter",escape:"esc"},_REVERSE_MAP=void 0,_callbacks={},_directMap={},_sequenceLevels={},_resetTimer=void 0,_ignoreNextKeyup=!1,_sequenceType=!1,i=1;i<20;)_MAP[111+i]="f"+i,++i;for(i=0;i<=9;)_MAP[i+96]=i,++i;_characterFromEvent=function(e){return"keypress"===e.type?String.fromCharCode(e.which):_MAP[e.which]?_MAP[e.which]:_KEYCODE_MAP[e.which]?_KEYCODE_MAP[e.which]:String.fromCharCode(e.which).toLowerCase()},_modifiersMatch=function(modifiers1,modifiers2){return modifiers1.sort().join(",")===modifiers2.sort().join(",")},_resetSequences=function(doNotReset,maxLevel){var activeSequences,key;doNotReset=doNotReset||{},activeSequences=!1,key=void 0;for(key in _sequenceLevels)doNotReset[key]&&_sequenceLevels[key]>maxLevel?activeSequences=!0:_sequenceLevels[key]=0;if(!activeSequences)return _sequenceType=!1},_getMatches=function(character,modifiers,e,remove,combination){var action,callback,j,matches,ref;if(i=void 0,callback=void 0,matches=[],action=e.type,!_callbacks[character])return[];for("keyup"===action&&_isModifier(character)&&(modifiers=[character]),i=j=0,ref=_callbacks[character].length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)(callback=_callbacks[character][i]).seq&&_sequenceLevels[callback.seq]!==callback.level||action===callback.action&&("keypress"===action&&!e.metaKey&&!e.ctrlKey||_modifiersMatch(modifiers,callback.modifiers))&&(remove&&callback.combo===combination&&_callbacks[character].splice(i,1),matches.push(callback));return matches},_eventModifiers=function(e){var modifiers;return modifiers=[],e.shiftKey&&modifiers.push("shift"),e.altKey&&modifiers.push("alt"),e.ctrlKey&&modifiers.push("ctrl"),e.metaKey&&modifiers.push("meta"),modifiers},_fireCallback=function(callback,e,combo){if(!Mousetrap.stopCallback(e,e.target||e.srcElement,combo))return!1===callback(e,combo)?(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.returnValue=!1,e.cancelBubble=!0):void 0},_handleCharacter=function(character,e){var callbacks,doNotReset,maxLevel,processedSequenceCallback;for(callbacks=_getMatches(character,_eventModifiers(e),e),i=void 0,doNotReset={},maxLevel=0,processedSequenceCallback=!1,i=0;i<callbacks.length;)callbacks[i].seq?(processedSequenceCallback=!0,maxLevel=Math.max(maxLevel,callbacks[i].level),doNotReset[callbacks[i].seq]=1,_fireCallback(callbacks[i].callback,e,callbacks[i].combo)):(processedSequenceCallback||_sequenceType||_fireCallback(callbacks[i].callback,e,callbacks[i].combo),++i);if(e.type===_sequenceType&&!_isModifier(character))return _resetSequences(doNotReset,maxLevel)},_handleKey=function(e){var character;if("number"!=typeof e.which&&(e.which=e.keyCode),character=_characterFromEvent(e)){if("keyup"!==e.type||_ignoreNextKeyup!==character)return _handleCharacter(character,e);_ignoreNextKeyup=!1}},_isModifier=function(key){return"shift"===key||"ctrl"===key||"alt"===key||"meta"===key},_resetSequenceTimer=function(){return clearTimeout(_resetTimer),_resetTimer=setTimeout(_resetSequences,1e3)},_getReverseMap=function(){var key;if(!_REVERSE_MAP){_REVERSE_MAP={};for(key in _MAP)key>95&&key<112||_MAP.hasOwnProperty(key)&&(_REVERSE_MAP[_MAP[key]]=key)}return _REVERSE_MAP},_pickBestAction=function(key,modifiers,action){return action||(action=_getReverseMap()[key]?"keydown":"keypress"),"keypress"===action&&modifiers.length&&(action="keydown"),action},_bindSequence=function(combo,keys,callback,action){var _callbackAndReset,_increaseSequence,results;for(_sequenceLevels[combo]=0,action||(action=_pickBestAction(keys[0],[])),_increaseSequence=function(){return _sequenceType=action,++_sequenceLevels[combo],_resetSequenceTimer()},_callbackAndReset=function(e){return _fireCallback(callback,e,combo),"keyup"!==action&&(_ignoreNextKeyup=_characterFromEvent(e)),setTimeout(_resetSequences,10)},i=void 0,i=0,results=[];i<keys.length;)_bindSingle(keys[i],i<keys.length-1?_increaseSequence:_callbackAndReset,action,combo,i),results.push(++i);return results},_bindSingle=function(combination,callback,action,sequenceName,level){var key,keys,modifiers,sequence;if(_directMap[combination+":"+action]=callback,sequence=(combination=combination.replace(/\s+/g," ")).split(" "),i=void 0,key=void 0,keys=void 0,modifiers=[],!(sequence.length>1)){for(keys="+"===combination?["+"]:combination.split("+"),i=0;i<keys.length;)key=keys[i],_SPECIAL_ALIASES[key]&&(key=_SPECIAL_ALIASES[key]),action&&"keypress"!==action&&_SHIFT_MAP[key]&&(key=_SHIFT_MAP[key],modifiers.push("shift")),_isModifier(key)&&modifiers.push(key),++i;return action=_pickBestAction(key,modifiers,action),_callbacks[key]||(_callbacks[key]=[]),_getMatches(key,modifiers,{type:action},!sequenceName,combination),_callbacks[key][sequenceName?"unshift":"push"]({callback:callback,modifiers:modifiers,action:action,seq:sequenceName,level:level,combo:combination})}_bindSequence(combination,sequence,callback,action)},_bindMultiple=function(combinations,callback,action){var results;for(i=0,results=[];i<combinations.length;)_bindSingle(combinations[i],callback,action),results.push(++i);return results},(_addEvent=function(object,type,callback){if(!object.addEventListener)return object.attachEvent("on"+type,callback);object.addEventListener(type,callback,!1)})(document,"keypress",_handleKey),_addEvent(document,"keydown",_handleKey),_addEvent(document,"keyup",_handleKey),Mousetrap={bind:function(keys,callback,action){return keys=keys instanceof Array?keys:[keys],_bindMultiple(keys,callback,action),this},unbind:function(keys,action){return Mousetrap.bind(keys,function(){},action)},trigger:function(keys,action){return _directMap[keys+":"+action]&&_directMap[keys+":"+action]({},keys),this},reset:function(){return _callbacks={},_directMap={},this},stopCallback:function(e,element){return!(" "+element.className+" ").contains(" mousetrap ")&&("INPUT"===element.tagName||"SELECT"===element.tagName||"TEXTAREA"===element.tagName||element.contentEditable&&"true"===element.contentEditable)}},window.Mousetrap=Mousetrap;